
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Recording economic and finacial news.">
      
      
        <meta name="author" content="Diperluer">
      
      
        <link rel="canonical" href="https://www.diperluer.cn/proj/cam/android-camera2%E6%8B%8D%E7%85%A7%E6%B5%81%E7%A8%8B/">
      
      
      
      
      <link rel="icon" href="../../../assets/32x_code_computer.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>android camera2拍照流程 - 滴尔</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#android_camera2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="滴尔" class="md-header__button md-logo" aria-label="滴尔" data-md-component="logo">
      
  <img src="../../../assets/code_computer.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            滴尔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              android camera2拍照流程
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  <font size=5>主页</font>

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../blog/archive/" class="md-tabs__link">
        
  
    
  
  <font size=5>归档</font>

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../blog/tag/" class="md-tabs__link">
        
  
    
  
  <font size=5>标签</font>

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../level11/%E4%B8%AD%E4%B8%9C%E5%B1%80%E5%8A%BF/Middle_East/" class="md-tabs__link">
          
  
    
  
  <font size=5>地区冲突</font>

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../level21/%E7%BB%8F%E6%B5%8E%E6%94%BF%E7%AD%96/economic/" class="md-tabs__link">
          
  
    
  
  <font size=5>经济和货币政策</font>

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../level31/invest/" class="md-tabs__link">
        
  
    
  
  <font size=5>投资指南</font>

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="滴尔" class="md-nav__button md-logo" aria-label="滴尔" data-md-component="logo">
      
  <img src="../../../assets/code_computer.png" alt="logo">

    </a>
    滴尔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font size=5>主页</font>
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font size=5>归档</font>
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/tag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font size=5>标签</font>
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <font size=5>地区冲突</font>
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            <font size=5>地区冲突</font>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level11/%E4%B8%AD%E4%B8%9C%E5%B1%80%E5%8A%BF/Middle_East/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font face="黑体" color=#FF4500>中东局势</font>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level11/%E4%BF%84%E4%B9%8C%E6%88%98%E4%BA%89/Russia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font face="黑体" color=#FF4500>俄乌战争</font>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level11/%E6%9C%9D%E9%B2%9C%E5%8D%8A%E5%B2%9B/North_Korea/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font face="黑体" color=#FF4500>朝鲜半岛</font>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <font size=5>经济和货币政策</font>
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            <font size=5>经济和货币政策</font>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level21/%E7%BB%8F%E6%B5%8E%E6%94%BF%E7%AD%96/economic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font face="黑体" color=#FF4500>经济政策</font>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level21/%E8%B4%A7%E5%B8%81%E6%94%BF%E7%AD%96/currency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font face="黑体" color=#FF4500>货币政策</font>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level31/invest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <font size=5>投资指南</font>
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="android_camera2"><span style="font-family: '黑体'; color: #FF4500; font-size: 1em;">android camera2拍照流程</span><a class="headerlink" href="#android_camera2" title="Permanent link">#</a></h1>
<h1 id="_1"><font face="黑体" color=#FF4500 size="5">正文</font><a class="headerlink" href="#_1" title="Permanent link">#</a></h1>
<p>camera2 API 的加入是从AndroidV5.0(21)开始的，因此我们使用Camera2应该是在Android 5.0(含5.0)之后。同时，对于Android6.0我们需要有动态权限的管理。这两点应该是使用Camera2使用前的最基本认知。Android 5.0对拍照API进行了全新的设计，新增了全新设计的Camera v2 API，这些API不仅大幅提高了Android系统拍照的功能，还能支持RAW照片输出，甚至允许程序调整相机的对焦模式、曝光模式、快门等。下面不做过多介绍了，直接开撸了。</p>
<h2 id="camera2"><font face="黑体" color=#FF4500 size="4">Camera2包架构示意图</font><a class="headerlink" href="#camera2" title="Permanent link">#</a></h2>
<p>我们先来看看 camera2包架构示意图(不用一下子理解，只需要有个整体印象)：<br></p>
<!-- ![alt text](./campic/campic_20250614-3-a.png) -->

<p><a href="/proj/cam/campic/campic_20250614-3-a.png" target="_blank">
  <img src="/proj/cam/campic/campic_20250614-3-a.png" alt="xx" width="500"/>
</a></p>
<h3 id="camera2_1"><font face="黑体" color=#FF4500 size="3">下面是 camera2包中的主要类：</font><a class="headerlink" href="#camera2_1" title="Permanent link">#</a></h3>
<!-- ![alt text](./campic/campic_20250614-3-b.png) -->

<p><a href="/proj/cam/campic/campic_20250614-3-b.png" target="_blank">
  <img src="/proj/cam/campic/campic_20250614-3-b.png" alt="xx" width="500"/>
</a></p>
<p>CameraManager：摄像头管理器。这是一个全新的系统管理器，专门用于检测系统摄像头、打开系统摄像头。另外，调用CameraManager的getCameraCharacteristics(String cameraId)方法即可获取指定摄像头的相关特性。</p>
<p>CameraCharacteristics：摄像头特性。该对象通过CameraManager来获取，用于描述特定摄像头所支持的各种特性。类似与原来的CameraInfo 。</p>
<p>CameraDevice：代表系统摄像头。该类的功能类似于早期的Camera类。而每个CameraDevice自己会负责创建CameraCaptureSession 以及建立 CaptureRequest。</p>
<p>CameraCaptureSession：这是一个非常重要的API，当程序需要预览、拍照时，都需要先通过该类的实例创建Session。而且不管预览还是拍照，也都是由该对象的方法进行控制的，其中控制预览的方法为setRepeatingRequest()；控制拍照的方法为capture()。为了监听CameraCaptureSession的创建过程，以及监听CameraCaptureSession的拍照过程，Camera-v2-API为CameraCaptureSession提供了StateCallback、CaptureCallback等内部类。</p>
<p>CameraRequest和CameraRequest.Builder：当程序调用setRepeatingRequest()方法进行预览时，或调用capture()方法进行拍照时，都需要传入CameraRequest参数。CameraRequest代表了一次捕获请求，用于描述捕获图片的各种参数设置，比如对焦模式、曝光模式……总之，程序需要对照片所做的各种控制，都通过CameraRequest参数进行设置。CameraRequest.Builder则负责生成CameraRequest对象。</p>
<h3 id="_2"><font face="黑体" color=#FF4500 size="3">相机预览与拍照流程</font><a class="headerlink" href="#_2" title="Permanent link">#</a></h3>
<!-- ![alt text](./campic/campic_20250614-3-c.png) -->

<p><a href="/proj/cam/campic/campic_20250616-1-a.png" target="_blank">
  <img src="/proj/cam/campic/campic_20250616-1-a.png" alt="xx" width="500"/>
</a></p>
<p>如果你看不太懂流程图，没关系，待会儿我们通过代码就可以更好的理解了。首先，Google官方推荐的Camera2控制拍照的步骤大致如下。</p>
<p>(1)用CameraManager的openCamera(String cameraId, CameraDevice.StateCallback callback, Handler handler)方法打开指定摄像头。该方法的第一个参数代表要打开的摄像头ID；第二个参数用于监听摄像头的状态；第三个参数代表执行callback的Handler，如果程序希望直接在当前线程中执行callback，则可将handler参数设为null。</p>
<p>(2)当摄像头被打开之后会回调接口mStateCallback.onOpened，程序即可获取CameraDevice —— 即根据摄像头ID获取了指定摄像头设备，然后调用CameraDevice的createCaptureSession(List outputs, CameraCaptureSession. StateCallback callback，Handler handler)方法来创建CameraCaptureSession。该方法的第一个参数是一个List集合，封装了所有需要从该摄像头获取图片的Surface，第二个参数用于监听CameraCaptureSession的创建过程；第三个参数代表执行callback的Handler，如果程序希望直接在当前线程中执行callback，则可将handler参数设为null。</p>
<p>(3)不管预览还是拍照，程序都调用CameraDevice的createCaptureRequest(int templateType)方法创建CaptureRequest.Builder，该方法支持TEMPLATE_PREVIEW（预览）、TEMPLATE_RECORD（拍摄视频）、TEMPLATE_STILL_CAPTURE（拍照）等参数。</p>
<p>(4)通过第3步所调用方法返回的CaptureRequest.Builder设置拍照的各种参数，比如对焦模式、曝光模式等。</p>
<p>(5)调用CaptureRequest.Builder的build()方法即可得到CaptureRequest对象，接下来程序可通过CameraCaptureSession的setRepeatingRequest()方法开始预览，或调用capture()方法拍照。相机的预览与拍照流程我们基本了解了。</p>
<p>(6)预览时，是将mSurfaceHolder.getSurface()作为目标，使用setRepeatingRequest()方法，显示拍照结果时，是将mImageReader.getSurface()作为目标，使用capture()方法。</p>
<p>然后这里还有一个大招：Google官方Camera2拍照的demo的地址：点击跳转<a href="https://github.com/googlearchive/android-Camera2Basic" target="_blank">android-Camera2Basic</a></p>
<h1 id="layout"><font face="黑体" color=#FF4500 size="5">首先是我们的layout代码</font><a class="headerlink" href="#layout" title="Permanent link">#</a></h1>
<p>首先权限不能忘：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>uses-permission android:name=”android.permission.CAMERA” /
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>uses-feature android:name=”android.hardware.camera” /
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>uses-feature android:name=”android.hardware.camera.autofocus” /
</code></pre></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="o">&lt;</span><span class="n">LinearLayout</span><span class="w"> </span><span class="n">xmlns</span><span class="p">:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="n">android</span><span class="p">:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">TextureView</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/texture&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">layout_weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">/&gt;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">LinearLayout</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">        </span><span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">Button</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;0dp&quot;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/cancelButton&quot;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;取消&quot;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">visibility</span><span class="o">=</span><span class="s">&quot;invisible&quot;</span><span class="o">/&gt;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">Button</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;0dp&quot;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/captureButton&quot;</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;拍照&quot;</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">visibility</span><span class="o">=</span><span class="s">&quot;visible&quot;</span><span class="o">/&gt;</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">Button</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;0dp&quot;</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">layout_weight</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/saveButton&quot;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;保存&quot;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">            </span><span class="n">android</span><span class="p">:</span><span class="n">visibility</span><span class="o">=</span><span class="s">&quot;invisible&quot;</span><span class="o">/&gt;</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<h1 id="_3"><font face="黑体" color=#FF4500 size="5">下面是我的代码</font><a class="headerlink" href="#_3" title="Permanent link">#</a></h1>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span>
<span class="normal"><a href="#__codelineno-2-137">137</a></span>
<span class="normal"><a href="#__codelineno-2-138">138</a></span>
<span class="normal"><a href="#__codelineno-2-139">139</a></span>
<span class="normal"><a href="#__codelineno-2-140">140</a></span>
<span class="normal"><a href="#__codelineno-2-141">141</a></span>
<span class="normal"><a href="#__codelineno-2-142">142</a></span>
<span class="normal"><a href="#__codelineno-2-143">143</a></span>
<span class="normal"><a href="#__codelineno-2-144">144</a></span>
<span class="normal"><a href="#__codelineno-2-145">145</a></span>
<span class="normal"><a href="#__codelineno-2-146">146</a></span>
<span class="normal"><a href="#__codelineno-2-147">147</a></span>
<span class="normal"><a href="#__codelineno-2-148">148</a></span>
<span class="normal"><a href="#__codelineno-2-149">149</a></span>
<span class="normal"><a href="#__codelineno-2-150">150</a></span>
<span class="normal"><a href="#__codelineno-2-151">151</a></span>
<span class="normal"><a href="#__codelineno-2-152">152</a></span>
<span class="normal"><a href="#__codelineno-2-153">153</a></span>
<span class="normal"><a href="#__codelineno-2-154">154</a></span>
<span class="normal"><a href="#__codelineno-2-155">155</a></span>
<span class="normal"><a href="#__codelineno-2-156">156</a></span>
<span class="normal"><a href="#__codelineno-2-157">157</a></span>
<span class="normal"><a href="#__codelineno-2-158">158</a></span>
<span class="normal"><a href="#__codelineno-2-159">159</a></span>
<span class="normal"><a href="#__codelineno-2-160">160</a></span>
<span class="normal"><a href="#__codelineno-2-161">161</a></span>
<span class="normal"><a href="#__codelineno-2-162">162</a></span>
<span class="normal"><a href="#__codelineno-2-163">163</a></span>
<span class="normal"><a href="#__codelineno-2-164">164</a></span>
<span class="normal"><a href="#__codelineno-2-165">165</a></span>
<span class="normal"><a href="#__codelineno-2-166">166</a></span>
<span class="normal"><a href="#__codelineno-2-167">167</a></span>
<span class="normal"><a href="#__codelineno-2-168">168</a></span>
<span class="normal"><a href="#__codelineno-2-169">169</a></span>
<span class="normal"><a href="#__codelineno-2-170">170</a></span>
<span class="normal"><a href="#__codelineno-2-171">171</a></span>
<span class="normal"><a href="#__codelineno-2-172">172</a></span>
<span class="normal"><a href="#__codelineno-2-173">173</a></span>
<span class="normal"><a href="#__codelineno-2-174">174</a></span>
<span class="normal"><a href="#__codelineno-2-175">175</a></span>
<span class="normal"><a href="#__codelineno-2-176">176</a></span>
<span class="normal"><a href="#__codelineno-2-177">177</a></span>
<span class="normal"><a href="#__codelineno-2-178">178</a></span>
<span class="normal"><a href="#__codelineno-2-179">179</a></span>
<span class="normal"><a href="#__codelineno-2-180">180</a></span>
<span class="normal"><a href="#__codelineno-2-181">181</a></span>
<span class="normal"><a href="#__codelineno-2-182">182</a></span>
<span class="normal"><a href="#__codelineno-2-183">183</a></span>
<span class="normal"><a href="#__codelineno-2-184">184</a></span>
<span class="normal"><a href="#__codelineno-2-185">185</a></span>
<span class="normal"><a href="#__codelineno-2-186">186</a></span>
<span class="normal"><a href="#__codelineno-2-187">187</a></span>
<span class="normal"><a href="#__codelineno-2-188">188</a></span>
<span class="normal"><a href="#__codelineno-2-189">189</a></span>
<span class="normal"><a href="#__codelineno-2-190">190</a></span>
<span class="normal"><a href="#__codelineno-2-191">191</a></span>
<span class="normal"><a href="#__codelineno-2-192">192</a></span>
<span class="normal"><a href="#__codelineno-2-193">193</a></span>
<span class="normal"><a href="#__codelineno-2-194">194</a></span>
<span class="normal"><a href="#__codelineno-2-195">195</a></span>
<span class="normal"><a href="#__codelineno-2-196">196</a></span>
<span class="normal"><a href="#__codelineno-2-197">197</a></span>
<span class="normal"><a href="#__codelineno-2-198">198</a></span>
<span class="normal"><a href="#__codelineno-2-199">199</a></span>
<span class="normal"><a href="#__codelineno-2-200">200</a></span>
<span class="normal"><a href="#__codelineno-2-201">201</a></span>
<span class="normal"><a href="#__codelineno-2-202">202</a></span>
<span class="normal"><a href="#__codelineno-2-203">203</a></span>
<span class="normal"><a href="#__codelineno-2-204">204</a></span>
<span class="normal"><a href="#__codelineno-2-205">205</a></span>
<span class="normal"><a href="#__codelineno-2-206">206</a></span>
<span class="normal"><a href="#__codelineno-2-207">207</a></span>
<span class="normal"><a href="#__codelineno-2-208">208</a></span>
<span class="normal"><a href="#__codelineno-2-209">209</a></span>
<span class="normal"><a href="#__codelineno-2-210">210</a></span>
<span class="normal"><a href="#__codelineno-2-211">211</a></span>
<span class="normal"><a href="#__codelineno-2-212">212</a></span>
<span class="normal"><a href="#__codelineno-2-213">213</a></span>
<span class="normal"><a href="#__codelineno-2-214">214</a></span>
<span class="normal"><a href="#__codelineno-2-215">215</a></span>
<span class="normal"><a href="#__codelineno-2-216">216</a></span>
<span class="normal"><a href="#__codelineno-2-217">217</a></span>
<span class="normal"><a href="#__codelineno-2-218">218</a></span>
<span class="normal"><a href="#__codelineno-2-219">219</a></span>
<span class="normal"><a href="#__codelineno-2-220">220</a></span>
<span class="normal"><a href="#__codelineno-2-221">221</a></span>
<span class="normal"><a href="#__codelineno-2-222">222</a></span>
<span class="normal"><a href="#__codelineno-2-223">223</a></span>
<span class="normal"><a href="#__codelineno-2-224">224</a></span>
<span class="normal"><a href="#__codelineno-2-225">225</a></span>
<span class="normal"><a href="#__codelineno-2-226">226</a></span>
<span class="normal"><a href="#__codelineno-2-227">227</a></span>
<span class="normal"><a href="#__codelineno-2-228">228</a></span>
<span class="normal"><a href="#__codelineno-2-229">229</a></span>
<span class="normal"><a href="#__codelineno-2-230">230</a></span>
<span class="normal"><a href="#__codelineno-2-231">231</a></span>
<span class="normal"><a href="#__codelineno-2-232">232</a></span>
<span class="normal"><a href="#__codelineno-2-233">233</a></span>
<span class="normal"><a href="#__codelineno-2-234">234</a></span>
<span class="normal"><a href="#__codelineno-2-235">235</a></span>
<span class="normal"><a href="#__codelineno-2-236">236</a></span>
<span class="normal"><a href="#__codelineno-2-237">237</a></span>
<span class="normal"><a href="#__codelineno-2-238">238</a></span>
<span class="normal"><a href="#__codelineno-2-239">239</a></span>
<span class="normal"><a href="#__codelineno-2-240">240</a></span>
<span class="normal"><a href="#__codelineno-2-241">241</a></span>
<span class="normal"><a href="#__codelineno-2-242">242</a></span>
<span class="normal"><a href="#__codelineno-2-243">243</a></span>
<span class="normal"><a href="#__codelineno-2-244">244</a></span>
<span class="normal"><a href="#__codelineno-2-245">245</a></span>
<span class="normal"><a href="#__codelineno-2-246">246</a></span>
<span class="normal"><a href="#__codelineno-2-247">247</a></span>
<span class="normal"><a href="#__codelineno-2-248">248</a></span>
<span class="normal"><a href="#__codelineno-2-249">249</a></span>
<span class="normal"><a href="#__codelineno-2-250">250</a></span>
<span class="normal"><a href="#__codelineno-2-251">251</a></span>
<span class="normal"><a href="#__codelineno-2-252">252</a></span>
<span class="normal"><a href="#__codelineno-2-253">253</a></span>
<span class="normal"><a href="#__codelineno-2-254">254</a></span>
<span class="normal"><a href="#__codelineno-2-255">255</a></span>
<span class="normal"><a href="#__codelineno-2-256">256</a></span>
<span class="normal"><a href="#__codelineno-2-257">257</a></span>
<span class="normal"><a href="#__codelineno-2-258">258</a></span>
<span class="normal"><a href="#__codelineno-2-259">259</a></span>
<span class="normal"><a href="#__codelineno-2-260">260</a></span>
<span class="normal"><a href="#__codelineno-2-261">261</a></span>
<span class="normal"><a href="#__codelineno-2-262">262</a></span>
<span class="normal"><a href="#__codelineno-2-263">263</a></span>
<span class="normal"><a href="#__codelineno-2-264">264</a></span>
<span class="normal"><a href="#__codelineno-2-265">265</a></span>
<span class="normal"><a href="#__codelineno-2-266">266</a></span>
<span class="normal"><a href="#__codelineno-2-267">267</a></span>
<span class="normal"><a href="#__codelineno-2-268">268</a></span>
<span class="normal"><a href="#__codelineno-2-269">269</a></span>
<span class="normal"><a href="#__codelineno-2-270">270</a></span>
<span class="normal"><a href="#__codelineno-2-271">271</a></span>
<span class="normal"><a href="#__codelineno-2-272">272</a></span>
<span class="normal"><a href="#__codelineno-2-273">273</a></span>
<span class="normal"><a href="#__codelineno-2-274">274</a></span>
<span class="normal"><a href="#__codelineno-2-275">275</a></span>
<span class="normal"><a href="#__codelineno-2-276">276</a></span>
<span class="normal"><a href="#__codelineno-2-277">277</a></span>
<span class="normal"><a href="#__codelineno-2-278">278</a></span>
<span class="normal"><a href="#__codelineno-2-279">279</a></span>
<span class="normal"><a href="#__codelineno-2-280">280</a></span>
<span class="normal"><a href="#__codelineno-2-281">281</a></span>
<span class="normal"><a href="#__codelineno-2-282">282</a></span>
<span class="normal"><a href="#__codelineno-2-283">283</a></span>
<span class="normal"><a href="#__codelineno-2-284">284</a></span>
<span class="normal"><a href="#__codelineno-2-285">285</a></span>
<span class="normal"><a href="#__codelineno-2-286">286</a></span>
<span class="normal"><a href="#__codelineno-2-287">287</a></span>
<span class="normal"><a href="#__codelineno-2-288">288</a></span>
<span class="normal"><a href="#__codelineno-2-289">289</a></span>
<span class="normal"><a href="#__codelineno-2-290">290</a></span>
<span class="normal"><a href="#__codelineno-2-291">291</a></span>
<span class="normal"><a href="#__codelineno-2-292">292</a></span>
<span class="normal"><a href="#__codelineno-2-293">293</a></span>
<span class="normal"><a href="#__codelineno-2-294">294</a></span>
<span class="normal"><a href="#__codelineno-2-295">295</a></span>
<span class="normal"><a href="#__codelineno-2-296">296</a></span>
<span class="normal"><a href="#__codelineno-2-297">297</a></span>
<span class="normal"><a href="#__codelineno-2-298">298</a></span>
<span class="normal"><a href="#__codelineno-2-299">299</a></span>
<span class="normal"><a href="#__codelineno-2-300">300</a></span>
<span class="normal"><a href="#__codelineno-2-301">301</a></span>
<span class="normal"><a href="#__codelineno-2-302">302</a></span>
<span class="normal"><a href="#__codelineno-2-303">303</a></span>
<span class="normal"><a href="#__codelineno-2-304">304</a></span>
<span class="normal"><a href="#__codelineno-2-305">305</a></span>
<span class="normal"><a href="#__codelineno-2-306">306</a></span>
<span class="normal"><a href="#__codelineno-2-307">307</a></span>
<span class="normal"><a href="#__codelineno-2-308">308</a></span>
<span class="normal"><a href="#__codelineno-2-309">309</a></span>
<span class="normal"><a href="#__codelineno-2-310">310</a></span>
<span class="normal"><a href="#__codelineno-2-311">311</a></span>
<span class="normal"><a href="#__codelineno-2-312">312</a></span>
<span class="normal"><a href="#__codelineno-2-313">313</a></span>
<span class="normal"><a href="#__codelineno-2-314">314</a></span>
<span class="normal"><a href="#__codelineno-2-315">315</a></span>
<span class="normal"><a href="#__codelineno-2-316">316</a></span>
<span class="normal"><a href="#__codelineno-2-317">317</a></span>
<span class="normal"><a href="#__codelineno-2-318">318</a></span>
<span class="normal"><a href="#__codelineno-2-319">319</a></span>
<span class="normal"><a href="#__codelineno-2-320">320</a></span>
<span class="normal"><a href="#__codelineno-2-321">321</a></span>
<span class="normal"><a href="#__codelineno-2-322">322</a></span>
<span class="normal"><a href="#__codelineno-2-323">323</a></span>
<span class="normal"><a href="#__codelineno-2-324">324</a></span>
<span class="normal"><a href="#__codelineno-2-325">325</a></span>
<span class="normal"><a href="#__codelineno-2-326">326</a></span>
<span class="normal"><a href="#__codelineno-2-327">327</a></span>
<span class="normal"><a href="#__codelineno-2-328">328</a></span>
<span class="normal"><a href="#__codelineno-2-329">329</a></span>
<span class="normal"><a href="#__codelineno-2-330">330</a></span>
<span class="normal"><a href="#__codelineno-2-331">331</a></span>
<span class="normal"><a href="#__codelineno-2-332">332</a></span>
<span class="normal"><a href="#__codelineno-2-333">333</a></span>
<span class="normal"><a href="#__codelineno-2-334">334</a></span>
<span class="normal"><a href="#__codelineno-2-335">335</a></span>
<span class="normal"><a href="#__codelineno-2-336">336</a></span>
<span class="normal"><a href="#__codelineno-2-337">337</a></span>
<span class="normal"><a href="#__codelineno-2-338">338</a></span>
<span class="normal"><a href="#__codelineno-2-339">339</a></span>
<span class="normal"><a href="#__codelineno-2-340">340</a></span>
<span class="normal"><a href="#__codelineno-2-341">341</a></span>
<span class="normal"><a href="#__codelineno-2-342">342</a></span>
<span class="normal"><a href="#__codelineno-2-343">343</a></span>
<span class="normal"><a href="#__codelineno-2-344">344</a></span>
<span class="normal"><a href="#__codelineno-2-345">345</a></span>
<span class="normal"><a href="#__codelineno-2-346">346</a></span>
<span class="normal"><a href="#__codelineno-2-347">347</a></span>
<span class="normal"><a href="#__codelineno-2-348">348</a></span>
<span class="normal"><a href="#__codelineno-2-349">349</a></span>
<span class="normal"><a href="#__codelineno-2-350">350</a></span>
<span class="normal"><a href="#__codelineno-2-351">351</a></span>
<span class="normal"><a href="#__codelineno-2-352">352</a></span>
<span class="normal"><a href="#__codelineno-2-353">353</a></span>
<span class="normal"><a href="#__codelineno-2-354">354</a></span>
<span class="normal"><a href="#__codelineno-2-355">355</a></span>
<span class="normal"><a href="#__codelineno-2-356">356</a></span>
<span class="normal"><a href="#__codelineno-2-357">357</a></span>
<span class="normal"><a href="#__codelineno-2-358">358</a></span>
<span class="normal"><a href="#__codelineno-2-359">359</a></span>
<span class="normal"><a href="#__codelineno-2-360">360</a></span>
<span class="normal"><a href="#__codelineno-2-361">361</a></span>
<span class="normal"><a href="#__codelineno-2-362">362</a></span>
<span class="normal"><a href="#__codelineno-2-363">363</a></span>
<span class="normal"><a href="#__codelineno-2-364">364</a></span>
<span class="normal"><a href="#__codelineno-2-365">365</a></span>
<span class="normal"><a href="#__codelineno-2-366">366</a></span>
<span class="normal"><a href="#__codelineno-2-367">367</a></span>
<span class="normal"><a href="#__codelineno-2-368">368</a></span>
<span class="normal"><a href="#__codelineno-2-369">369</a></span>
<span class="normal"><a href="#__codelineno-2-370">370</a></span>
<span class="normal"><a href="#__codelineno-2-371">371</a></span>
<span class="normal"><a href="#__codelineno-2-372">372</a></span>
<span class="normal"><a href="#__codelineno-2-373">373</a></span>
<span class="normal"><a href="#__codelineno-2-374">374</a></span>
<span class="normal"><a href="#__codelineno-2-375">375</a></span>
<span class="normal"><a href="#__codelineno-2-376">376</a></span>
<span class="normal"><a href="#__codelineno-2-377">377</a></span>
<span class="normal"><a href="#__codelineno-2-378">378</a></span>
<span class="normal"><a href="#__codelineno-2-379">379</a></span>
<span class="normal"><a href="#__codelineno-2-380">380</a></span>
<span class="normal"><a href="#__codelineno-2-381">381</a></span>
<span class="normal"><a href="#__codelineno-2-382">382</a></span>
<span class="normal"><a href="#__codelineno-2-383">383</a></span>
<span class="normal"><a href="#__codelineno-2-384">384</a></span>
<span class="normal"><a href="#__codelineno-2-385">385</a></span>
<span class="normal"><a href="#__codelineno-2-386">386</a></span>
<span class="normal"><a href="#__codelineno-2-387">387</a></span>
<span class="normal"><a href="#__codelineno-2-388">388</a></span>
<span class="normal"><a href="#__codelineno-2-389">389</a></span>
<span class="normal"><a href="#__codelineno-2-390">390</a></span>
<span class="normal"><a href="#__codelineno-2-391">391</a></span>
<span class="normal"><a href="#__codelineno-2-392">392</a></span>
<span class="normal"><a href="#__codelineno-2-393">393</a></span>
<span class="normal"><a href="#__codelineno-2-394">394</a></span>
<span class="normal"><a href="#__codelineno-2-395">395</a></span>
<span class="normal"><a href="#__codelineno-2-396">396</a></span>
<span class="normal"><a href="#__codelineno-2-397">397</a></span>
<span class="normal"><a href="#__codelineno-2-398">398</a></span>
<span class="normal"><a href="#__codelineno-2-399">399</a></span>
<span class="normal"><a href="#__codelineno-2-400">400</a></span>
<span class="normal"><a href="#__codelineno-2-401">401</a></span>
<span class="normal"><a href="#__codelineno-2-402">402</a></span>
<span class="normal"><a href="#__codelineno-2-403">403</a></span>
<span class="normal"><a href="#__codelineno-2-404">404</a></span>
<span class="normal"><a href="#__codelineno-2-405">405</a></span>
<span class="normal"><a href="#__codelineno-2-406">406</a></span>
<span class="normal"><a href="#__codelineno-2-407">407</a></span>
<span class="normal"><a href="#__codelineno-2-408">408</a></span>
<span class="normal"><a href="#__codelineno-2-409">409</a></span>
<span class="normal"><a href="#__codelineno-2-410">410</a></span>
<span class="normal"><a href="#__codelineno-2-411">411</a></span>
<span class="normal"><a href="#__codelineno-2-412">412</a></span>
<span class="normal"><a href="#__codelineno-2-413">413</a></span>
<span class="normal"><a href="#__codelineno-2-414">414</a></span>
<span class="normal"><a href="#__codelineno-2-415">415</a></span>
<span class="normal"><a href="#__codelineno-2-416">416</a></span>
<span class="normal"><a href="#__codelineno-2-417">417</a></span>
<span class="normal"><a href="#__codelineno-2-418">418</a></span>
<span class="normal"><a href="#__codelineno-2-419">419</a></span>
<span class="normal"><a href="#__codelineno-2-420">420</a></span>
<span class="normal"><a href="#__codelineno-2-421">421</a></span>
<span class="normal"><a href="#__codelineno-2-422">422</a></span>
<span class="normal"><a href="#__codelineno-2-423">423</a></span>
<span class="normal"><a href="#__codelineno-2-424">424</a></span>
<span class="normal"><a href="#__codelineno-2-425">425</a></span>
<span class="normal"><a href="#__codelineno-2-426">426</a></span>
<span class="normal"><a href="#__codelineno-2-427">427</a></span>
<span class="normal"><a href="#__codelineno-2-428">428</a></span>
<span class="normal"><a href="#__codelineno-2-429">429</a></span>
<span class="normal"><a href="#__codelineno-2-430">430</a></span>
<span class="normal"><a href="#__codelineno-2-431">431</a></span>
<span class="normal"><a href="#__codelineno-2-432">432</a></span>
<span class="normal"><a href="#__codelineno-2-433">433</a></span>
<span class="normal"><a href="#__codelineno-2-434">434</a></span>
<span class="normal"><a href="#__codelineno-2-435">435</a></span>
<span class="normal"><a href="#__codelineno-2-436">436</a></span>
<span class="normal"><a href="#__codelineno-2-437">437</a></span>
<span class="normal"><a href="#__codelineno-2-438">438</a></span>
<span class="normal"><a href="#__codelineno-2-439">439</a></span>
<span class="normal"><a href="#__codelineno-2-440">440</a></span>
<span class="normal"><a href="#__codelineno-2-441">441</a></span>
<span class="normal"><a href="#__codelineno-2-442">442</a></span>
<span class="normal"><a href="#__codelineno-2-443">443</a></span>
<span class="normal"><a href="#__codelineno-2-444">444</a></span>
<span class="normal"><a href="#__codelineno-2-445">445</a></span>
<span class="normal"><a href="#__codelineno-2-446">446</a></span>
<span class="normal"><a href="#__codelineno-2-447">447</a></span>
<span class="normal"><a href="#__codelineno-2-448">448</a></span>
<span class="normal"><a href="#__codelineno-2-449">449</a></span>
<span class="normal"><a href="#__codelineno-2-450">450</a></span>
<span class="normal"><a href="#__codelineno-2-451">451</a></span>
<span class="normal"><a href="#__codelineno-2-452">452</a></span>
<span class="normal"><a href="#__codelineno-2-453">453</a></span>
<span class="normal"><a href="#__codelineno-2-454">454</a></span>
<span class="normal"><a href="#__codelineno-2-455">455</a></span>
<span class="normal"><a href="#__codelineno-2-456">456</a></span>
<span class="normal"><a href="#__codelineno-2-457">457</a></span>
<span class="normal"><a href="#__codelineno-2-458">458</a></span>
<span class="normal"><a href="#__codelineno-2-459">459</a></span>
<span class="normal"><a href="#__codelineno-2-460">460</a></span>
<span class="normal"><a href="#__codelineno-2-461">461</a></span>
<span class="normal"><a href="#__codelineno-2-462">462</a></span>
<span class="normal"><a href="#__codelineno-2-463">463</a></span>
<span class="normal"><a href="#__codelineno-2-464">464</a></span>
<span class="normal"><a href="#__codelineno-2-465">465</a></span>
<span class="normal"><a href="#__codelineno-2-466">466</a></span>
<span class="normal"><a href="#__codelineno-2-467">467</a></span>
<span class="normal"><a href="#__codelineno-2-468">468</a></span>
<span class="normal"><a href="#__codelineno-2-469">469</a></span>
<span class="normal"><a href="#__codelineno-2-470">470</a></span>
<span class="normal"><a href="#__codelineno-2-471">471</a></span>
<span class="normal"><a href="#__codelineno-2-472">472</a></span>
<span class="normal"><a href="#__codelineno-2-473">473</a></span>
<span class="normal"><a href="#__codelineno-2-474">474</a></span>
<span class="normal"><a href="#__codelineno-2-475">475</a></span>
<span class="normal"><a href="#__codelineno-2-476">476</a></span>
<span class="normal"><a href="#__codelineno-2-477">477</a></span>
<span class="normal"><a href="#__codelineno-2-478">478</a></span>
<span class="normal"><a href="#__codelineno-2-479">479</a></span>
<span class="normal"><a href="#__codelineno-2-480">480</a></span>
<span class="normal"><a href="#__codelineno-2-481">481</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">customCarmeraActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CAMERA_PERMISSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">STATE_PREVIEW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">STATE_WAITING_PRECAPTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATE_PREVIEW</span><span class="p">;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SparseIntArray</span><span class="w"> </span><span class="n">ORIENTATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SparseIntArray</span><span class="p">();</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="c1">///为了使照片竖直显示</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">        </span><span class="n">ORIENTATIONS</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">Surface</span><span class="p">.</span><span class="na">ROTATION_0</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">);</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">        </span><span class="n">ORIENTATIONS</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">Surface</span><span class="p">.</span><span class="na">ROTATION_90</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">        </span><span class="n">ORIENTATIONS</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">Surface</span><span class="p">.</span><span class="na">ROTATION_180</span><span class="p">,</span><span class="w"> </span><span class="mi">270</span><span class="p">);</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">        </span><span class="n">ORIENTATIONS</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">Surface</span><span class="p">.</span><span class="na">ROTATION_270</span><span class="p">,</span><span class="w"> </span><span class="mi">180</span><span class="p">);</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CameraManager</span><span class="w"> </span><span class="n">mCameraManagerm</span><span class="p">;</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CameraDevice</span><span class="w"> </span><span class="n">mCameraDevice</span><span class="p">;</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">mCameraId</span><span class="p">;</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">HandlerThread</span><span class="w"> </span><span class="n">mBackgroundThread</span><span class="p">;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">mBackgroundHandler</span><span class="p">;</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TextureView</span><span class="w"> </span><span class="n">mTextureView</span><span class="p">;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ImageReader</span><span class="w"> </span><span class="n">mImageReader</span><span class="p">;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">mFile</span><span class="p">;</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">mPreviewBuilder</span><span class="p">;</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CaptureRequest</span><span class="w"> </span><span class="n">mPreviewRequest</span><span class="p">;</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="w"> </span><span class="n">mCaptureSession</span><span class="p">;</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Semaphore</span><span class="w"> </span><span class="n">mCameraOpenCloseLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="cm">     * Starts a background thread and its {@link Handler}.</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="cm">     */</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startBackgroundThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">        </span><span class="n">mBackgroundThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HandlerThread</span><span class="p">(</span><span class="s">&quot;CameraBackground&quot;</span><span class="p">);</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="w">        </span><span class="n">mBackgroundThread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">        </span><span class="n">mBackgroundHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">(</span><span class="n">mBackgroundThread</span><span class="p">.</span><span class="na">getLooper</span><span class="p">());</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="cm">     * Stops the background thread and its {@link Handler}.</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="cm">     */</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stopBackgroundThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="w">        </span><span class="n">mBackgroundThread</span><span class="p">.</span><span class="na">quitSafely</span><span class="p">();</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">            </span><span class="n">mBackgroundThread</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">            </span><span class="n">mBackgroundThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="w">            </span><span class="n">mBackgroundHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="cm">     *</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="cm">     * @TextureView.SurfaceTextureListener：public static interface</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="cm">     * @onSurfaceTextureAvailable：Invoked when a TextureView&#39;s SurfaceTexture is ready for use.</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="cm">     * @onSurfaceTextureSizeChanged：Invoked when the SurfaceTexture&#39;s buffers size changed.</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="cm">     * @onSurfaceTextureDestroyed：Invoked when the specified SurfaceTexture is about to be destroyed.</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="cm">     * @onSurfaceTextureUpdated：Invoked when the specified SurfaceTexture is updated through updateTexImage().</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="cm">     */</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">TextureView</span><span class="p">.</span><span class="na">SurfaceTextureListener</span><span class="w"> </span><span class="n">mSurfaceTextureListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TextureView</span><span class="p">.</span><span class="na">SurfaceTextureListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onSurfaceTextureAvailable</span><span class="p">(</span><span class="n">SurfaceTexture</span><span class="w"> </span><span class="n">texture</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="w">            </span><span class="n">openCamera</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onSurfaceTextureSizeChanged</span><span class="p">(</span><span class="n">SurfaceTexture</span><span class="w"> </span><span class="n">texture</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a><span class="w">            </span><span class="c1">//configureTransform(width, height);</span>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">onSurfaceTextureDestroyed</span><span class="p">(</span><span class="n">SurfaceTexture</span><span class="w"> </span><span class="n">texture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onSurfaceTextureUpdated</span><span class="p">(</span><span class="n">SurfaceTexture</span><span class="w"> </span><span class="n">texture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a><span class="cm">     * Shows a {@link Toast} on the UI thread.</span>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="cm">     *</span>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="cm">     * @param text The message to show</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="cm">     */</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showToast</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="w">        </span><span class="n">runOnUiThread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-96" name="__codelineno-2-96"></a><span class="w">                </span><span class="nd">@Override</span>
<a id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="w">                    </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">customCarmeraActivity</span><span class="p">.</span><span class="na">this</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_SHORT</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-100" name="__codelineno-2-100"></a><span class="w">            </span><span class="p">});</span>
<a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-102" name="__codelineno-2-102"></a>
<a id="__codelineno-2-103" name="__codelineno-2-103"></a>
<a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="cm">     * Capture a still picture. This method should be called when we get a response in</span>
<a id="__codelineno-2-106" name="__codelineno-2-106"></a><span class="cm">     * {@link #mCaptureCallback} from both {@link #lockFocus()}.</span>
<a id="__codelineno-2-107" name="__codelineno-2-107"></a><span class="cm">     */</span>
<a id="__codelineno-2-108" name="__codelineno-2-108"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">captureStillPicture</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-110" name="__codelineno-2-110"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mCameraDevice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-111" name="__codelineno-2-111"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-112" name="__codelineno-2-112"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-113" name="__codelineno-2-113"></a><span class="w">            </span><span class="c1">// This is the CaptureRequest.Builder that we use to take a picture.</span>
<a id="__codelineno-2-114" name="__codelineno-2-114"></a><span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">captureBuilder</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-2-115" name="__codelineno-2-115"></a><span class="w">                    </span><span class="n">mCameraDevice</span><span class="p">.</span><span class="na">createCaptureRequest</span><span class="p">(</span><span class="n">CameraDevice</span><span class="p">.</span><span class="na">TEMPLATE_STILL_CAPTURE</span><span class="p">);</span>
<a id="__codelineno-2-116" name="__codelineno-2-116"></a><span class="w">            </span><span class="n">captureBuilder</span><span class="p">.</span><span class="na">addTarget</span><span class="p">(</span><span class="n">mImageReader</span><span class="p">.</span><span class="na">getSurface</span><span class="p">());</span><span class="c1">//拍照时，是将mImageReader.getSurface()作为目标</span>
<a id="__codelineno-2-117" name="__codelineno-2-117"></a>
<a id="__codelineno-2-118" name="__codelineno-2-118"></a><span class="w">            </span><span class="c1">// Use the same AE and AF modes as the preview.</span>
<a id="__codelineno-2-119" name="__codelineno-2-119"></a><span class="w">            </span><span class="n">captureBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AF_MODE</span><span class="p">,</span>
<a id="__codelineno-2-120" name="__codelineno-2-120"></a><span class="w">                    </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AF_MODE_CONTINUOUS_PICTURE</span><span class="p">);</span>
<a id="__codelineno-2-121" name="__codelineno-2-121"></a><span class="w">            </span><span class="n">captureBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AE_MODE</span><span class="p">,</span>
<a id="__codelineno-2-122" name="__codelineno-2-122"></a><span class="w">                    </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AE_MODE_ON_AUTO_FLASH</span><span class="p">);</span>
<a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="w">            </span><span class="c1">// Orientation</span>
<a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getWindowManager</span><span class="p">().</span><span class="na">getDefaultDisplay</span><span class="p">().</span><span class="na">getRotation</span><span class="p">();</span>
<a id="__codelineno-2-125" name="__codelineno-2-125"></a><span class="w">            </span><span class="n">captureBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">JPEG_ORIENTATION</span><span class="p">,</span><span class="w"> </span><span class="n">ORIENTATIONS</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">rotation</span><span class="p">));</span>
<a id="__codelineno-2-126" name="__codelineno-2-126"></a>
<a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="w">            </span><span class="n">CameraCaptureSession</span><span class="p">.</span><span class="na">CaptureCallback</span><span class="w"> </span><span class="n">CaptureCallback</span>
<a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="p">.</span><span class="na">CaptureCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-129" name="__codelineno-2-129"></a>
<a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="w">                </span><span class="nd">@Override</span>
<a id="__codelineno-2-131" name="__codelineno-2-131"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCaptureCompleted</span><span class="p">(</span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="w"> </span><span class="n">session</span><span class="p">,</span>
<a id="__codelineno-2-132" name="__codelineno-2-132"></a><span class="w">                                               </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">CaptureRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<a id="__codelineno-2-133" name="__codelineno-2-133"></a><span class="w">                                               </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">TotalCaptureResult</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-134" name="__codelineno-2-134"></a><span class="w">                    </span><span class="n">showToast</span><span class="p">(</span><span class="s">&quot;Saved: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mFile</span><span class="p">);</span>
<a id="__codelineno-2-135" name="__codelineno-2-135"></a>
<a id="__codelineno-2-136" name="__codelineno-2-136"></a><span class="w">                    </span><span class="c1">//Log.d(&quot;customCarmeraActivity&quot;, mFile.toString());</span>
<a id="__codelineno-2-137" name="__codelineno-2-137"></a><span class="w">                    </span><span class="n">unlockFocus</span><span class="p">();</span><span class="c1">//恢复预览</span>
<a id="__codelineno-2-138" name="__codelineno-2-138"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-139" name="__codelineno-2-139"></a><span class="w">            </span><span class="p">};</span>
<a id="__codelineno-2-140" name="__codelineno-2-140"></a>
<a id="__codelineno-2-141" name="__codelineno-2-141"></a><span class="w">            </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">stopRepeating</span><span class="p">();</span>
<a id="__codelineno-2-142" name="__codelineno-2-142"></a><span class="w">            </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">abortCaptures</span><span class="p">();</span>
<a id="__codelineno-2-143" name="__codelineno-2-143"></a><span class="w">            </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">capture</span><span class="p">(</span><span class="n">captureBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">(),</span><span class="w"> </span><span class="n">CaptureCallback</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-2-144" name="__codelineno-2-144"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-145" name="__codelineno-2-145"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-146" name="__codelineno-2-146"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-147" name="__codelineno-2-147"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-148" name="__codelineno-2-148"></a>
<a id="__codelineno-2-149" name="__codelineno-2-149"></a>
<a id="__codelineno-2-150" name="__codelineno-2-150"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="p">.</span><span class="na">CaptureCallback</span><span class="w"> </span><span class="n">mCaptureCallback</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-2-151" name="__codelineno-2-151"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="p">.</span><span class="na">CaptureCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-152" name="__codelineno-2-152"></a><span class="w">                </span><span class="nd">@Override</span>
<a id="__codelineno-2-153" name="__codelineno-2-153"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCaptureCompleted</span><span class="p">(</span><span class="n">CameraCaptureSession</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">CaptureRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<a id="__codelineno-2-154" name="__codelineno-2-154"></a><span class="w">                                               </span><span class="n">TotalCaptureResult</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-155" name="__codelineno-2-155"></a><span class="w">                    </span><span class="c1">//Log.d(&quot;linc&quot;,&quot;mSessionCaptureCallback, onCaptureCompleted&quot;);</span>
<a id="__codelineno-2-156" name="__codelineno-2-156"></a><span class="w">                    </span><span class="n">mCaptureSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">;</span>
<a id="__codelineno-2-157" name="__codelineno-2-157"></a><span class="w">                    </span><span class="n">checkState</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<a id="__codelineno-2-158" name="__codelineno-2-158"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-159" name="__codelineno-2-159"></a>
<a id="__codelineno-2-160" name="__codelineno-2-160"></a><span class="w">                </span><span class="nd">@Override</span>
<a id="__codelineno-2-161" name="__codelineno-2-161"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCaptureProgressed</span><span class="p">(</span><span class="n">CameraCaptureSession</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">CaptureRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<a id="__codelineno-2-162" name="__codelineno-2-162"></a><span class="w">                                                </span><span class="n">CaptureResult</span><span class="w"> </span><span class="n">partialResult</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-163" name="__codelineno-2-163"></a><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&quot;linc&quot;</span><span class="p">,</span><span class="s">&quot;mSessionCaptureCallback,  onCaptureProgressed&quot;</span><span class="p">);</span>
<a id="__codelineno-2-164" name="__codelineno-2-164"></a><span class="w">                    </span><span class="n">mCaptureSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">;</span>
<a id="__codelineno-2-165" name="__codelineno-2-165"></a><span class="w">                    </span><span class="n">checkState</span><span class="p">(</span><span class="n">partialResult</span><span class="p">);</span>
<a id="__codelineno-2-166" name="__codelineno-2-166"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-167" name="__codelineno-2-167"></a>
<a id="__codelineno-2-168" name="__codelineno-2-168"></a><span class="w">                </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkState</span><span class="p">(</span><span class="n">CaptureResult</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-169" name="__codelineno-2-169"></a><span class="w">                    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">mState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-170" name="__codelineno-2-170"></a><span class="w">                        </span><span class="k">case</span><span class="w"> </span><span class="n">STATE_PREVIEW</span><span class="p">:</span>
<a id="__codelineno-2-171" name="__codelineno-2-171"></a><span class="w">                            </span><span class="c1">// We have nothing to do when the camera preview is working normally.</span>
<a id="__codelineno-2-172" name="__codelineno-2-172"></a><span class="w">                            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-2-173" name="__codelineno-2-173"></a><span class="w">                        </span><span class="k">case</span><span class="w"> </span><span class="n">STATE_WAITING_PRECAPTURE</span><span class="p">:</span>
<a id="__codelineno-2-174" name="__codelineno-2-174"></a><span class="w">                            </span><span class="n">Integer</span><span class="w"> </span><span class="n">afState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">CaptureResult</span><span class="p">.</span><span class="na">CONTROL_AF_STATE</span><span class="p">);</span>
<a id="__codelineno-2-175" name="__codelineno-2-175"></a><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">afState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-176" name="__codelineno-2-176"></a><span class="w">                                </span><span class="n">captureStillPicture</span><span class="p">();</span>
<a id="__codelineno-2-177" name="__codelineno-2-177"></a><span class="w">                            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CaptureResult</span><span class="p">.</span><span class="na">CONTROL_AF_STATE_FOCUSED_LOCKED</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">afState</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">CaptureResult</span><span class="p">.</span><span class="na">CONTROL_AF_STATE_NOT_FOCUSED_LOCKED</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">afState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-178" name="__codelineno-2-178"></a><span class="w">                                </span><span class="c1">// CONTROL_AE_STATE can be null on some devices</span>
<a id="__codelineno-2-179" name="__codelineno-2-179"></a><span class="w">                                </span><span class="n">Integer</span><span class="w"> </span><span class="n">aeState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">CaptureResult</span><span class="p">.</span><span class="na">CONTROL_AE_STATE</span><span class="p">);</span>
<a id="__codelineno-2-180" name="__codelineno-2-180"></a><span class="w">                                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">aeState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">aeState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CaptureResult</span><span class="p">.</span><span class="na">CONTROL_AE_STATE_CONVERGED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-181" name="__codelineno-2-181"></a><span class="w">                                    </span><span class="c1">//mState = STATE_PICTURE_TAKEN;</span>
<a id="__codelineno-2-182" name="__codelineno-2-182"></a><span class="w">                                    </span><span class="n">captureStillPicture</span><span class="p">();</span>
<a id="__codelineno-2-183" name="__codelineno-2-183"></a><span class="w">                                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-184" name="__codelineno-2-184"></a><span class="w">                                    </span><span class="c1">//runPrecaptureSequence();//视频拍摄</span>
<a id="__codelineno-2-185" name="__codelineno-2-185"></a><span class="w">                                </span><span class="p">}</span>
<a id="__codelineno-2-186" name="__codelineno-2-186"></a><span class="w">                            </span><span class="p">}</span>
<a id="__codelineno-2-187" name="__codelineno-2-187"></a><span class="w">                            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-2-188" name="__codelineno-2-188"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-2-189" name="__codelineno-2-189"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-190" name="__codelineno-2-190"></a>
<a id="__codelineno-2-191" name="__codelineno-2-191"></a><span class="w">            </span><span class="p">};</span>
<a id="__codelineno-2-192" name="__codelineno-2-192"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createCameraPreviewSession</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-193" name="__codelineno-2-193"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-194" name="__codelineno-2-194"></a><span class="w">            </span><span class="n">SurfaceTexture</span><span class="w"> </span><span class="n">texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mTextureView</span><span class="p">.</span><span class="na">getSurfaceTexture</span><span class="p">();</span>
<a id="__codelineno-2-195" name="__codelineno-2-195"></a><span class="w">            </span><span class="c1">//assert(texture != null);</span>
<a id="__codelineno-2-196" name="__codelineno-2-196"></a>
<a id="__codelineno-2-197" name="__codelineno-2-197"></a><span class="w">            </span><span class="c1">// We configure the size of default buffer to be the size of camera preview we want.</span>
<a id="__codelineno-2-198" name="__codelineno-2-198"></a><span class="w">            </span><span class="n">texture</span><span class="p">.</span><span class="na">setDefaultBufferSize</span><span class="p">(</span><span class="n">mTextureView</span><span class="p">.</span><span class="na">getWidth</span><span class="p">(),</span><span class="w"> </span><span class="n">mTextureView</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
<a id="__codelineno-2-199" name="__codelineno-2-199"></a><span class="w">            </span><span class="c1">// This is the output Surface we need to start preview.</span>
<a id="__codelineno-2-200" name="__codelineno-2-200"></a><span class="w">            </span><span class="n">Surface</span><span class="w"> </span><span class="n">surface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Surface</span><span class="p">(</span><span class="n">texture</span><span class="p">);</span>
<a id="__codelineno-2-201" name="__codelineno-2-201"></a>
<a id="__codelineno-2-202" name="__codelineno-2-202"></a><span class="w">            </span><span class="n">mPreviewBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mCameraDevice</span><span class="p">.</span><span class="na">createCaptureRequest</span><span class="p">(</span><span class="n">CameraDevice</span><span class="p">.</span><span class="na">TEMPLATE_PREVIEW</span><span class="p">);</span>
<a id="__codelineno-2-203" name="__codelineno-2-203"></a><span class="w">            </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">addTarget</span><span class="p">(</span><span class="n">surface</span><span class="p">);</span><span class="c1">//预览时，是将Surface()作为目标</span>
<a id="__codelineno-2-204" name="__codelineno-2-204"></a><span class="w">            </span><span class="n">mState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATE_PREVIEW</span><span class="p">;</span>
<a id="__codelineno-2-205" name="__codelineno-2-205"></a><span class="w">            </span><span class="n">mCameraDevice</span><span class="p">.</span><span class="na">createCaptureSession</span><span class="p">(</span>
<a id="__codelineno-2-206" name="__codelineno-2-206"></a><span class="w">                    </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span><span class="w"> </span><span class="n">mImageReader</span><span class="p">.</span><span class="na">getSurface</span><span class="p">()),</span>
<a id="__codelineno-2-207" name="__codelineno-2-207"></a><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="p">.</span><span class="na">StateCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-208" name="__codelineno-2-208"></a><span class="w">                        </span><span class="nd">@Override</span>
<a id="__codelineno-2-209" name="__codelineno-2-209"></a><span class="w">                        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onConfigured</span><span class="p">(</span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="w"> </span><span class="n">cameraCaptureSession</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-210" name="__codelineno-2-210"></a><span class="w">                            </span><span class="c1">// The camera is already closed</span>
<a id="__codelineno-2-211" name="__codelineno-2-211"></a><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mCameraDevice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-212" name="__codelineno-2-212"></a><span class="w">                                </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-213" name="__codelineno-2-213"></a><span class="w">                            </span><span class="p">}</span>
<a id="__codelineno-2-214" name="__codelineno-2-214"></a><span class="w">                            </span><span class="n">mCaptureSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameraCaptureSession</span><span class="p">;</span>
<a id="__codelineno-2-215" name="__codelineno-2-215"></a><span class="w">                            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-216" name="__codelineno-2-216"></a><span class="w">                                </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AF_MODE</span><span class="p">,</span>
<a id="__codelineno-2-217" name="__codelineno-2-217"></a><span class="w">                                        </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AF_MODE_CONTINUOUS_PICTURE</span><span class="p">);</span>
<a id="__codelineno-2-218" name="__codelineno-2-218"></a><span class="w">                                </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AE_MODE</span><span class="p">,</span>
<a id="__codelineno-2-219" name="__codelineno-2-219"></a><span class="w">                                        </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AE_MODE_ON_AUTO_FLASH</span><span class="p">);</span>
<a id="__codelineno-2-220" name="__codelineno-2-220"></a><span class="w">                                </span><span class="n">mPreviewRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-2-221" name="__codelineno-2-221"></a><span class="w">                                </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">setRepeatingRequest</span><span class="p">(</span><span class="n">mPreviewRequest</span><span class="p">,</span><span class="w"> </span><span class="n">mCaptureCallback</span><span class="p">,</span><span class="w"> </span><span class="n">mBackgroundHandler</span><span class="p">);</span>
<a id="__codelineno-2-222" name="__codelineno-2-222"></a><span class="w">                            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-223" name="__codelineno-2-223"></a><span class="w">                                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-224" name="__codelineno-2-224"></a><span class="w">                                </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;linc&quot;</span><span class="p">,</span><span class="s">&quot;set preview builder failed.&quot;</span><span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-2-225" name="__codelineno-2-225"></a><span class="w">                            </span><span class="p">}</span>
<a id="__codelineno-2-226" name="__codelineno-2-226"></a><span class="w">                        </span><span class="p">}</span>
<a id="__codelineno-2-227" name="__codelineno-2-227"></a>
<a id="__codelineno-2-228" name="__codelineno-2-228"></a><span class="w">                        </span><span class="nd">@Override</span>
<a id="__codelineno-2-229" name="__codelineno-2-229"></a><span class="w">                        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onConfigureFailed</span><span class="p">(</span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">CameraCaptureSession</span><span class="w"> </span><span class="n">cameraCaptureSession</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-230" name="__codelineno-2-230"></a><span class="w">                            </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">customCarmeraActivity</span><span class="p">.</span><span class="na">this</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Camera configuration Failed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_SHORT</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-2-231" name="__codelineno-2-231"></a><span class="w">                        </span><span class="p">}</span>
<a id="__codelineno-2-232" name="__codelineno-2-232"></a><span class="w">                    </span><span class="p">},</span><span class="n">mBackgroundHandler</span><span class="p">);</span>
<a id="__codelineno-2-233" name="__codelineno-2-233"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-234" name="__codelineno-2-234"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-235" name="__codelineno-2-235"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-236" name="__codelineno-2-236"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-237" name="__codelineno-2-237"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-238" name="__codelineno-2-238"></a><span class="cm">     *</span>
<a id="__codelineno-2-239" name="__codelineno-2-239"></a><span class="cm">     * @CameraDevice.StateCallback：public static abstract class</span>
<a id="__codelineno-2-240" name="__codelineno-2-240"></a><span class="cm">     * @onOpened：This method is called when the camera is opened.  We start camera preview here.</span>
<a id="__codelineno-2-241" name="__codelineno-2-241"></a><span class="cm">     * @onDisconnected：The method called when a camera device is no longer available for use.</span>
<a id="__codelineno-2-242" name="__codelineno-2-242"></a><span class="cm">     * @onError：The method called when a camera device has encountered a serious error.</span>
<a id="__codelineno-2-243" name="__codelineno-2-243"></a><span class="cm">     */</span>
<a id="__codelineno-2-244" name="__codelineno-2-244"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CameraDevice</span><span class="p">.</span><span class="na">StateCallback</span><span class="w"> </span><span class="n">mStateCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CameraDevice</span><span class="p">.</span><span class="na">StateCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-245" name="__codelineno-2-245"></a>
<a id="__codelineno-2-246" name="__codelineno-2-246"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-247" name="__codelineno-2-247"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOpened</span><span class="p">(</span><span class="n">CameraDevice</span><span class="w"> </span><span class="n">cameraDevice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-248" name="__codelineno-2-248"></a><span class="w">            </span><span class="n">mCameraOpenCloseLock</span><span class="p">.</span><span class="na">release</span><span class="p">();</span>
<a id="__codelineno-2-249" name="__codelineno-2-249"></a><span class="w">            </span><span class="n">mCameraDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameraDevice</span><span class="p">;</span>
<a id="__codelineno-2-250" name="__codelineno-2-250"></a><span class="w">            </span><span class="n">createCameraPreviewSession</span><span class="p">();</span>
<a id="__codelineno-2-251" name="__codelineno-2-251"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-252" name="__codelineno-2-252"></a>
<a id="__codelineno-2-253" name="__codelineno-2-253"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-254" name="__codelineno-2-254"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onDisconnected</span><span class="p">(</span><span class="n">CameraDevice</span><span class="w"> </span><span class="n">cameraDevice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-255" name="__codelineno-2-255"></a><span class="w">            </span><span class="n">mCameraOpenCloseLock</span><span class="p">.</span><span class="na">release</span><span class="p">();</span>
<a id="__codelineno-2-256" name="__codelineno-2-256"></a><span class="w">            </span><span class="n">cameraDevice</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-257" name="__codelineno-2-257"></a><span class="w">            </span><span class="n">mCameraDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-258" name="__codelineno-2-258"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-259" name="__codelineno-2-259"></a>
<a id="__codelineno-2-260" name="__codelineno-2-260"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-261" name="__codelineno-2-261"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">CameraDevice</span><span class="w"> </span><span class="n">cameraDevice</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-262" name="__codelineno-2-262"></a><span class="w">            </span><span class="n">mCameraOpenCloseLock</span><span class="p">.</span><span class="na">release</span><span class="p">();</span>
<a id="__codelineno-2-263" name="__codelineno-2-263"></a><span class="w">            </span><span class="n">cameraDevice</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-264" name="__codelineno-2-264"></a><span class="w">            </span><span class="n">mCameraDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-265" name="__codelineno-2-265"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-266" name="__codelineno-2-266"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-2-267" name="__codelineno-2-267"></a>
<a id="__codelineno-2-268" name="__codelineno-2-268"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCameraId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-269" name="__codelineno-2-269"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-270" name="__codelineno-2-270"></a><span class="w">            </span><span class="c1">//Return the list of currently connected camera devices by identifier, including cameras that may be in use by other camera API clients</span>
<a id="__codelineno-2-271" name="__codelineno-2-271"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cameraId</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">mCameraManagerm</span><span class="p">.</span><span class="na">getCameraIdList</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-272" name="__codelineno-2-272"></a><span class="w">                </span><span class="c1">//Query the capabilities of a camera device</span>
<a id="__codelineno-2-273" name="__codelineno-2-273"></a><span class="w">                </span><span class="n">CameraCharacteristics</span><span class="w"> </span><span class="n">characteristics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mCameraManagerm</span><span class="p">.</span><span class="na">getCameraCharacteristics</span><span class="p">(</span><span class="n">cameraId</span><span class="p">);</span>
<a id="__codelineno-2-274" name="__codelineno-2-274"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">characteristics</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">CameraCharacteristics</span><span class="p">.</span><span class="na">LENS_FACING</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CameraCharacteristics</span><span class="p">.</span><span class="na">LENS_FACING_FRONT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-275" name="__codelineno-2-275"></a><span class="w">                    </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-2-276" name="__codelineno-2-276"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-277" name="__codelineno-2-277"></a><span class="w">                </span><span class="n">mCameraId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameraId</span><span class="p">;</span>
<a id="__codelineno-2-278" name="__codelineno-2-278"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-279" name="__codelineno-2-279"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-280" name="__codelineno-2-280"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-281" name="__codelineno-2-281"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-282" name="__codelineno-2-282"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-283" name="__codelineno-2-283"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-284" name="__codelineno-2-284"></a>
<a id="__codelineno-2-285" name="__codelineno-2-285"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-286" name="__codelineno-2-286"></a><span class="cm">     * Saves a JPEG {@link Image} into the specified {@link File}.</span>
<a id="__codelineno-2-287" name="__codelineno-2-287"></a><span class="cm">     */</span>
<a id="__codelineno-2-288" name="__codelineno-2-288"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ImageSaver</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-289" name="__codelineno-2-289"></a>
<a id="__codelineno-2-290" name="__codelineno-2-290"></a><span class="w">        </span><span class="cm">/**</span>
<a id="__codelineno-2-291" name="__codelineno-2-291"></a><span class="cm">         * The JPEG image</span>
<a id="__codelineno-2-292" name="__codelineno-2-292"></a><span class="cm">         */</span>
<a id="__codelineno-2-293" name="__codelineno-2-293"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="n">mImage</span><span class="p">;</span>
<a id="__codelineno-2-294" name="__codelineno-2-294"></a><span class="w">        </span><span class="cm">/**</span>
<a id="__codelineno-2-295" name="__codelineno-2-295"></a><span class="cm">         * The file we save the image into.</span>
<a id="__codelineno-2-296" name="__codelineno-2-296"></a><span class="cm">         */</span>
<a id="__codelineno-2-297" name="__codelineno-2-297"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">mFile</span><span class="p">;</span>
<a id="__codelineno-2-298" name="__codelineno-2-298"></a>
<a id="__codelineno-2-299" name="__codelineno-2-299"></a><span class="w">        </span><span class="n">ImageSaver</span><span class="p">(</span><span class="n">Image</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-300" name="__codelineno-2-300"></a><span class="w">            </span><span class="n">mImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">;</span>
<a id="__codelineno-2-301" name="__codelineno-2-301"></a><span class="w">            </span><span class="n">mFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">;</span>
<a id="__codelineno-2-302" name="__codelineno-2-302"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-303" name="__codelineno-2-303"></a>
<a id="__codelineno-2-304" name="__codelineno-2-304"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-305" name="__codelineno-2-305"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-306" name="__codelineno-2-306"></a><span class="w">            </span><span class="n">ByteBuffer</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mImage</span><span class="p">.</span><span class="na">getPlanes</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getBuffer</span><span class="p">();</span>
<a id="__codelineno-2-307" name="__codelineno-2-307"></a><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="n">buffer</span><span class="p">.</span><span class="na">remaining</span><span class="p">()</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-2-308" name="__codelineno-2-308"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
<a id="__codelineno-2-309" name="__codelineno-2-309"></a><span class="w">            </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-310" name="__codelineno-2-310"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-311" name="__codelineno-2-311"></a><span class="w">                </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">mFile</span><span class="p">);</span>
<a id="__codelineno-2-312" name="__codelineno-2-312"></a><span class="w">                </span><span class="n">output</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
<a id="__codelineno-2-313" name="__codelineno-2-313"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-314" name="__codelineno-2-314"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-315" name="__codelineno-2-315"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-316" name="__codelineno-2-316"></a><span class="w">                </span><span class="n">mImage</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-317" name="__codelineno-2-317"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-318" name="__codelineno-2-318"></a><span class="w">                    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-319" name="__codelineno-2-319"></a><span class="w">                        </span><span class="n">output</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-320" name="__codelineno-2-320"></a><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-321" name="__codelineno-2-321"></a><span class="w">                        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-322" name="__codelineno-2-322"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-2-323" name="__codelineno-2-323"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-2-324" name="__codelineno-2-324"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-325" name="__codelineno-2-325"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-326" name="__codelineno-2-326"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-327" name="__codelineno-2-327"></a>
<a id="__codelineno-2-328" name="__codelineno-2-328"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ImageReader</span><span class="p">.</span><span class="na">OnImageAvailableListener</span><span class="w"> </span><span class="n">mOnImageAvailableListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageReader</span><span class="p">.</span><span class="na">OnImageAvailableListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-329" name="__codelineno-2-329"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-2-330" name="__codelineno-2-330"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onImageAvailable</span><span class="p">(</span><span class="n">ImageReader</span><span class="w"> </span><span class="n">reader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-331" name="__codelineno-2-331"></a><span class="w">            </span><span class="c1">//showToast(&quot;onImageAvailable: &quot; );</span>
<a id="__codelineno-2-332" name="__codelineno-2-332"></a><span class="w">            </span><span class="n">mBackgroundHandler</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ImageSaver</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="na">acquireNextImage</span><span class="p">(),</span><span class="w"> </span><span class="n">mFile</span><span class="p">));</span>
<a id="__codelineno-2-333" name="__codelineno-2-333"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-334" name="__codelineno-2-334"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-2-335" name="__codelineno-2-335"></a><span class="w">    </span><span class="c1">//TODO 执行完上面的请求权限后，系统会弹出提示框让用户选择是否允许改权限。选择的结果可以在回到接口中得知：</span>
<a id="__codelineno-2-336" name="__codelineno-2-336"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-2-337" name="__codelineno-2-337"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRequestPermissionsResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-338" name="__codelineno-2-338"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">REQUEST_CAMERA_PERMISSION</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-339" name="__codelineno-2-339"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">grantResults</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">grantResults</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">PERMISSION_GRANTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-340" name="__codelineno-2-340"></a><span class="w">                </span><span class="c1">//用户允许改权限，0表示允许，-1表示拒绝 PERMISSION_GRANTED = 0， PERMISSION_DENIED = -1</span>
<a id="__codelineno-2-341" name="__codelineno-2-341"></a><span class="w">                </span><span class="c1">//permission was granted, yay! Do the contacts-related task you need to do.</span>
<a id="__codelineno-2-342" name="__codelineno-2-342"></a><span class="w">                </span><span class="c1">//这里进行授权被允许的处理</span>
<a id="__codelineno-2-343" name="__codelineno-2-343"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-344" name="__codelineno-2-344"></a><span class="w">                </span><span class="c1">//permission denied, boo! Disable the functionality that depends on this permission.</span>
<a id="__codelineno-2-345" name="__codelineno-2-345"></a><span class="w">                </span><span class="c1">//这里进行权限被拒绝的处理</span>
<a id="__codelineno-2-346" name="__codelineno-2-346"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-347" name="__codelineno-2-347"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-348" name="__codelineno-2-348"></a><span class="w">            </span><span class="kd">super</span><span class="p">.</span><span class="na">onRequestPermissionsResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">grantResults</span><span class="p">);</span>
<a id="__codelineno-2-349" name="__codelineno-2-349"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-350" name="__codelineno-2-350"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-351" name="__codelineno-2-351"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-352" name="__codelineno-2-352"></a><span class="cm">     * Opens the camera specified by {@link Camera2BasicFragment#mCameraId}.</span>
<a id="__codelineno-2-353" name="__codelineno-2-353"></a><span class="cm">     */</span>
<a id="__codelineno-2-354" name="__codelineno-2-354"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">openCamera</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-355" name="__codelineno-2-355"></a><span class="w">        </span><span class="c1">//检查相机服务的访问权限</span>
<a id="__codelineno-2-356" name="__codelineno-2-356"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ContextCompat</span><span class="p">.</span><span class="na">checkSelfPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">CAMERA</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">PERMISSION_GRANTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-357" name="__codelineno-2-357"></a><span class="w">            </span><span class="c1">//Toast.makeText(this,&quot;Lacking privileges to access camera service, please request permission first&quot;,Toast.LENGTH_SHORT).show();</span>
<a id="__codelineno-2-358" name="__codelineno-2-358"></a><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;customCarmeraActivity.openCamera&quot;</span><span class="p">,</span><span class="s">&quot;Lacking privileges to access camera service, please request permission first&quot;</span><span class="p">);</span>
<a id="__codelineno-2-359" name="__codelineno-2-359"></a><span class="w">            </span><span class="n">ActivityCompat</span><span class="p">.</span><span class="na">requestPermissions</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">CAMERA</span><span class="p">},</span><span class="w"> </span><span class="n">REQUEST_CAMERA_PERMISSION</span><span class="p">);</span><span class="c1">//API21后，向用户请求相机使用权限，然后执行onRequestPermissionsResult回调</span>
<a id="__codelineno-2-360" name="__codelineno-2-360"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-2-361" name="__codelineno-2-361"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-362" name="__codelineno-2-362"></a>
<a id="__codelineno-2-363" name="__codelineno-2-363"></a><span class="w">        </span><span class="n">getCameraId</span><span class="p">();</span>
<a id="__codelineno-2-364" name="__codelineno-2-364"></a><span class="w">        </span><span class="c1">//assert(mCameraId != null);</span>
<a id="__codelineno-2-365" name="__codelineno-2-365"></a>
<a id="__codelineno-2-366" name="__codelineno-2-366"></a><span class="w">        </span><span class="n">mImageReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageReader</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">ImageFormat</span><span class="p">.</span><span class="na">JPEG</span><span class="p">,</span><span class="cm">/*maxImages*/</span><span class="mi">7</span><span class="p">);</span>
<a id="__codelineno-2-367" name="__codelineno-2-367"></a><span class="w">        </span><span class="n">mImageReader</span><span class="p">.</span><span class="na">setOnImageAvailableListener</span><span class="p">(</span><span class="n">mOnImageAvailableListener</span><span class="p">,</span><span class="w"> </span><span class="n">mBackgroundHandler</span><span class="p">);</span>
<a id="__codelineno-2-368" name="__codelineno-2-368"></a>
<a id="__codelineno-2-369" name="__codelineno-2-369"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-370" name="__codelineno-2-370"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">mCameraOpenCloseLock</span><span class="p">.</span><span class="na">tryAcquire</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-371" name="__codelineno-2-371"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Time out waiting to lock camera opening.&quot;</span><span class="p">);</span>
<a id="__codelineno-2-372" name="__codelineno-2-372"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-373" name="__codelineno-2-373"></a><span class="w">            </span><span class="n">mCameraManagerm</span><span class="p">.</span><span class="na">openCamera</span><span class="p">(</span><span class="n">mCameraId</span><span class="p">,</span><span class="w"> </span><span class="n">mStateCallback</span><span class="p">,</span><span class="w"> </span><span class="n">mBackgroundHandler</span><span class="p">);</span>
<a id="__codelineno-2-374" name="__codelineno-2-374"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-375" name="__codelineno-2-375"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-376" name="__codelineno-2-376"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-377" name="__codelineno-2-377"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Interrupted while trying to lock camera opening.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-2-378" name="__codelineno-2-378"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-379" name="__codelineno-2-379"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-380" name="__codelineno-2-380"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-381" name="__codelineno-2-381"></a><span class="cm">     * Closes the current {@link CameraDevice}.</span>
<a id="__codelineno-2-382" name="__codelineno-2-382"></a><span class="cm">     */</span>
<a id="__codelineno-2-383" name="__codelineno-2-383"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">closeCamera</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-384" name="__codelineno-2-384"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-385" name="__codelineno-2-385"></a><span class="w">            </span><span class="n">mCameraOpenCloseLock</span><span class="p">.</span><span class="na">acquire</span><span class="p">();</span>
<a id="__codelineno-2-386" name="__codelineno-2-386"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mCaptureSession</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-387" name="__codelineno-2-387"></a><span class="w">                </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-388" name="__codelineno-2-388"></a><span class="w">                </span><span class="n">mCaptureSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-389" name="__codelineno-2-389"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-390" name="__codelineno-2-390"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mCameraDevice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-391" name="__codelineno-2-391"></a><span class="w">                </span><span class="n">mCameraDevice</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-392" name="__codelineno-2-392"></a><span class="w">                </span><span class="n">mCameraDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-393" name="__codelineno-2-393"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-394" name="__codelineno-2-394"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mImageReader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-395" name="__codelineno-2-395"></a><span class="w">                </span><span class="n">mImageReader</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-2-396" name="__codelineno-2-396"></a><span class="w">                </span><span class="n">mImageReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-397" name="__codelineno-2-397"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-398" name="__codelineno-2-398"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-399" name="__codelineno-2-399"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Interrupted while trying to lock camera closing.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-2-400" name="__codelineno-2-400"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-401" name="__codelineno-2-401"></a><span class="w">            </span><span class="n">mCameraOpenCloseLock</span><span class="p">.</span><span class="na">release</span><span class="p">();</span>
<a id="__codelineno-2-402" name="__codelineno-2-402"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-403" name="__codelineno-2-403"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-404" name="__codelineno-2-404"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-405" name="__codelineno-2-405"></a><span class="cm">     * Unlock the focus. This method should be called when still image capture sequence is</span>
<a id="__codelineno-2-406" name="__codelineno-2-406"></a><span class="cm">     * finished.</span>
<a id="__codelineno-2-407" name="__codelineno-2-407"></a><span class="cm">     */</span>
<a id="__codelineno-2-408" name="__codelineno-2-408"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">unlockFocus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-409" name="__codelineno-2-409"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-410" name="__codelineno-2-410"></a><span class="w">            </span><span class="c1">// Reset the auto-focus trigger</span>
<a id="__codelineno-2-411" name="__codelineno-2-411"></a><span class="w">            </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AF_TRIGGER</span><span class="p">,</span>
<a id="__codelineno-2-412" name="__codelineno-2-412"></a><span class="w">                    </span><span class="n">CameraMetadata</span><span class="p">.</span><span class="na">CONTROL_AF_TRIGGER_CANCEL</span><span class="p">);</span>
<a id="__codelineno-2-413" name="__codelineno-2-413"></a><span class="w">            </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AE_MODE</span><span class="p">,</span>
<a id="__codelineno-2-414" name="__codelineno-2-414"></a><span class="w">                    </span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AE_MODE_ON_AUTO_FLASH</span><span class="p">);</span>
<a id="__codelineno-2-415" name="__codelineno-2-415"></a><span class="w">     </span><span class="cm">/*       mCaptureSession.capture(mPreviewBuilder.build(), mCaptureCallback,</span>
<a id="__codelineno-2-416" name="__codelineno-2-416"></a><span class="cm">                    mBackgroundHandler);*/</span>
<a id="__codelineno-2-417" name="__codelineno-2-417"></a><span class="w">            </span><span class="c1">// After this, the camera will go back to the normal state of preview.</span>
<a id="__codelineno-2-418" name="__codelineno-2-418"></a><span class="w">            </span><span class="n">mState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATE_PREVIEW</span><span class="p">;</span>
<a id="__codelineno-2-419" name="__codelineno-2-419"></a><span class="w">            </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">setRepeatingRequest</span><span class="p">(</span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">(),</span><span class="w"> </span><span class="n">mCaptureCallback</span><span class="p">,</span><span class="w"> </span><span class="n">mBackgroundHandler</span><span class="p">);</span>
<a id="__codelineno-2-420" name="__codelineno-2-420"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-421" name="__codelineno-2-421"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-422" name="__codelineno-2-422"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-423" name="__codelineno-2-423"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-424" name="__codelineno-2-424"></a>
<a id="__codelineno-2-425" name="__codelineno-2-425"></a>
<a id="__codelineno-2-426" name="__codelineno-2-426"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-2-427" name="__codelineno-2-427"></a><span class="cm">     * Lock the focus as the first step for a still image capture.</span>
<a id="__codelineno-2-428" name="__codelineno-2-428"></a><span class="cm">     */</span>
<a id="__codelineno-2-429" name="__codelineno-2-429"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">lockFocus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-430" name="__codelineno-2-430"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-431" name="__codelineno-2-431"></a><span class="w">            </span><span class="c1">// This is how to tell the camera to lock focus.</span>
<a id="__codelineno-2-432" name="__codelineno-2-432"></a><span class="w">            </span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">CaptureRequest</span><span class="p">.</span><span class="na">CONTROL_AF_TRIGGER</span><span class="p">,</span>
<a id="__codelineno-2-433" name="__codelineno-2-433"></a><span class="w">                    </span><span class="n">CameraMetadata</span><span class="p">.</span><span class="na">CONTROL_AF_TRIGGER_START</span><span class="p">);</span>
<a id="__codelineno-2-434" name="__codelineno-2-434"></a><span class="w">            </span><span class="c1">// Tell #mCaptureCallback to wait for the lock.</span>
<a id="__codelineno-2-435" name="__codelineno-2-435"></a><span class="w">            </span><span class="n">mState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATE_WAITING_PRECAPTURE</span><span class="p">;</span>
<a id="__codelineno-2-436" name="__codelineno-2-436"></a><span class="w">            </span><span class="n">mCaptureSession</span><span class="p">.</span><span class="na">capture</span><span class="p">(</span><span class="n">mPreviewBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">(),</span><span class="w"> </span><span class="n">mCaptureCallback</span><span class="p">,</span>
<a id="__codelineno-2-437" name="__codelineno-2-437"></a><span class="w">                    </span><span class="n">mBackgroundHandler</span><span class="p">);</span>
<a id="__codelineno-2-438" name="__codelineno-2-438"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CameraAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-439" name="__codelineno-2-439"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-2-440" name="__codelineno-2-440"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-441" name="__codelineno-2-441"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-442" name="__codelineno-2-442"></a>
<a id="__codelineno-2-443" name="__codelineno-2-443"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-2-444" name="__codelineno-2-444"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-445" name="__codelineno-2-445"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<a id="__codelineno-2-446" name="__codelineno-2-446"></a><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">custom_carmera_layout</span><span class="p">);</span>
<a id="__codelineno-2-447" name="__codelineno-2-447"></a>
<a id="__codelineno-2-448" name="__codelineno-2-448"></a><span class="w">        </span><span class="n">mCameraManagerm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CameraManager</span><span class="p">)</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="na">CAMERA_SERVICE</span><span class="p">);</span>
<a id="__codelineno-2-449" name="__codelineno-2-449"></a><span class="w">        </span><span class="n">mTextureView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TextureView</span><span class="p">)</span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">textureview</span><span class="p">);</span>
<a id="__codelineno-2-450" name="__codelineno-2-450"></a>
<a id="__codelineno-2-451" name="__codelineno-2-451"></a><span class="w">        </span><span class="n">mFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">getExternalFilesDir</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;pic.jpg&quot;</span><span class="p">);</span>
<a id="__codelineno-2-452" name="__codelineno-2-452"></a>
<a id="__codelineno-2-453" name="__codelineno-2-453"></a><span class="w">        </span><span class="n">Button</span><span class="w"> </span><span class="n">tackPictureBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Button</span><span class="p">)</span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">takePictureButton</span><span class="p">);</span>
<a id="__codelineno-2-454" name="__codelineno-2-454"></a><span class="w">        </span><span class="n">tackPictureBtn</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="p">(){</span>
<a id="__codelineno-2-455" name="__codelineno-2-455"></a><span class="w">            </span><span class="nd">@Override</span>
<a id="__codelineno-2-456" name="__codelineno-2-456"></a><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-457" name="__codelineno-2-457"></a><span class="w">                </span><span class="c1">//Log.i(&quot;linc&quot;, &quot;take picture&quot;);</span>
<a id="__codelineno-2-458" name="__codelineno-2-458"></a><span class="w">                </span><span class="n">lockFocus</span><span class="p">();</span>
<a id="__codelineno-2-459" name="__codelineno-2-459"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-460" name="__codelineno-2-460"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-2-461" name="__codelineno-2-461"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-462" name="__codelineno-2-462"></a>
<a id="__codelineno-2-463" name="__codelineno-2-463"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-2-464" name="__codelineno-2-464"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onResume</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-465" name="__codelineno-2-465"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onResume</span><span class="p">();</span>
<a id="__codelineno-2-466" name="__codelineno-2-466"></a><span class="w">        </span><span class="n">startBackgroundThread</span><span class="p">();</span>
<a id="__codelineno-2-467" name="__codelineno-2-467"></a>
<a id="__codelineno-2-468" name="__codelineno-2-468"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">mTextureView</span><span class="p">.</span><span class="na">isAvailable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-469" name="__codelineno-2-469"></a><span class="w">            </span><span class="n">openCamera</span><span class="p">(</span><span class="n">mTextureView</span><span class="p">.</span><span class="na">getWidth</span><span class="p">(),</span><span class="w"> </span><span class="n">mTextureView</span><span class="p">.</span><span class="na">getHeight</span><span class="p">());</span>
<a id="__codelineno-2-470" name="__codelineno-2-470"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-2-471" name="__codelineno-2-471"></a><span class="w">            </span><span class="n">mTextureView</span><span class="p">.</span><span class="na">setSurfaceTextureListener</span><span class="p">(</span><span class="n">mSurfaceTextureListener</span><span class="p">);</span>
<a id="__codelineno-2-472" name="__codelineno-2-472"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-473" name="__codelineno-2-473"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-474" name="__codelineno-2-474"></a>
<a id="__codelineno-2-475" name="__codelineno-2-475"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-2-476" name="__codelineno-2-476"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onPause</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-477" name="__codelineno-2-477"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onPause</span><span class="p">();</span>
<a id="__codelineno-2-478" name="__codelineno-2-478"></a><span class="w">        </span><span class="n">closeCamera</span><span class="p">();</span>
<a id="__codelineno-2-479" name="__codelineno-2-479"></a><span class="w">        </span><span class="n">stopBackgroundThread</span><span class="p">();</span>
<a id="__codelineno-2-480" name="__codelineno-2-480"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-481" name="__codelineno-2-481"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">本文转发链接如下：</p>
</div>
<p><a href="https://blog.csdn.net/zhangzheng_1986/article/details/78710655" target="_blank">android camera2拍照流程</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright @ 2024 Diperluer, All rights reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.expand", "navigation.footer", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "header.autohide", "content.code.copy", "content.code.annotate", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>